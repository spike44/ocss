<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD SQL Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="car" >
    <typeAlias alias="carVO" type="disc.ocss.model.CarVO"/>
    <typeAlias alias="carTypeVO" type="disc.ocss.model.CarTypeVO"/>
    <typeAlias alias="carImageVO" type="disc.ocss.model.CarImagesVO"/>
    
    <resultMap class="carTypeVO" id="resultsBrand">
       <result property="brand" column="brand"/>
    </resultMap>
    <resultMap class="carTypeVO" id="resultsType">
    	<result property="carTypeCode" column="cartype_code"/>
       <result property="carType" column="car_type"/>
    </resultMap>
    
    <resultMap class="carVO" id="resultsCar">
    	<result property="carId" column="car_id"/>
    	<result property="memberId" column="member_id"/>
    	<result property="price" column="price"/>
    	<result property="carYear" column="car_year"/>
    	<result property="carYearEval" column="car_year_eval"/>
    	<result property="isAuto" column="is_auto"/>
    	<result property="isAcci" column="is_acci"/>
    	<result property="fuel" column="fuel"/>
    	<result property="color" column="color"/>
    	<result property="totalEval" column="total_eval"/>
    	<result property="carDesc" column="car_desc"/>
    	<result property="sellingStatus" column="selling_status"/>
    	<result property="title" column="title"/>
    	<result property="locationList" column="location_list"/>
    	<result property="cartypeCode" column="cartype_code"/>
    </resultMap>
    
    <resultMap class="carImageVO" id="resultsImage">
    	<result property="imageId" column="image_id"/>
    	<result property="carId" column="car_id"/>
    	<result property="images" column="images"/>
    	<result property="path" column="path"/>
    </resultMap>
    
	<statement id="selectCarType" parameterClass="carTypeVO" resultMap="resultsType">
		select * from cartype
		where brand = #brand#
	</statement>
	<statement id="selectCarBrand" resultMap="resultsBrand">
		select distinct brand from cartype
	</statement>
	
	
	<insert id="insertCar" parameterClass="carVO">
		
	</insert>
	
	<statement id="selectCar" parameterClass="carVO" resultMap="resultsCar">
		select * from car
			<dynamic prepend="where">
				<isNotEmpty property="carId" prepend="and">
					car_id = #carId#
				</isNotEmpty>
				<isNotEmpty property="memberId " prepend="and">
					member_id = #memberId#
				</isNotEmpty>
				<isNotEmpty property="price" prepend="and">
					price <![CDATA[ <= ]]>  #price#
				</isNotEmpty>				
				<isNotEmpty property="carYear" prepend="and">
					car_year <![CDATA[ <= ]]>  #carYear#
				</isNotEmpty>
				<isNotEmpty property="isAuto" prepend="and">
					is_auto = #isAuto#
				</isNotEmpty>
				<isNotEmpty property="isAcci" prepend="and">
					is_acci = #isAcci#
				</isNotEmpty>
				<isNotEmpty property="fuel" prepend="and">
					is_fuel = #fuel#
				</isNotEmpty>
				<isNotEmpty property="fuelEval" prepend="and">
					fuel_eval <![CDATA[ <= ]]>  #fuelEval#
				</isNotEmpty>
				<isNotEmpty property="color" prepend="and">
					color = #color#
				</isNotEmpty>
				<isNotEmpty property="locationList" prepend="and">
					location_list = #locationList#
				</isNotEmpty>
				<isNotEmpty property="title" prepend="and">
					title = %#title#%
				</isNotEmpty>
				<isNotEmpty property="carTypeCode" prepend="and">
					cartype_code = #carTypeCode#
				</isNotEmpty>
			</dynamic>	
			order by total_eval desc
	</statement>
	
	<statement id="selectImages" parameterClass="carImageVO" resultMap="resultsImage">
		select * from car_images
		where car_id = #carId#
	</statement>
	
	<statement id="selectMainImages" resultMap="resultsImage">
		select * from car_images
		where image_id in (select min(image_id) from car_images group by car_id)
	</statement>

	
</sqlMap>